{% extends 'base.html' %}
{% block content %}
<div class="max-w-5xl mx-auto">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-2xl font-bold">Gestão de Folgas e Feriados</h1>
        <button onclick="novaFolga()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 shadow">
            <i class="fa-solid fa-calendar-minus mr-2"></i> Cadastrar Folga/Férias
        </button>
    </div>

    <div class="bg-white rounded-xl shadow overflow-hidden">
        <table class="w-full text-left">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="px-6 py-3">Tipo</th>
                    <th class="px-6 py-3">Profissional</th>
                    <th class="px-6 py-3">Início</th>
                    <th class="px-6 py-3">Fim</th>
                    <th class="px-6 py-3 text-right">Ações</th>
                </tr>
            </thead>
            <tbody class="divide-y">
                {% for folga in folgas %}
                <tr>
                    <td class="px-6 py-4">
                        {% if folga.profissional %}
                            <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-bold">INDIVIDUAL</span>
                        {% else %}
                            <span class="bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs font-bold">COLETIVA</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">{{ folga.profissional.nome|default:"Todos (Salão Fechado)" }}</td>
                    <td class="px-6 py-4 text-sm">{{ folga.data_inicio|date:"d/m/Y H:i" }}</td>
                    <td class="px-6 py-4 text-sm">{{ folga.data_fim|date:"d/m/Y H:i" }}</td>
                    <td class="px-6 py-4 text-right">
                        <button class="text-red-400 hover:text-red-600"><i class="fa-solid fa-trash"></i></button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function novaFolga() {
    Swal.fire({
        title: 'Bloquear Agenda',
        html: `
            <div class="text-left space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-400">TIPO DE FOLGA</label>
                    <select id="f-tipo" class="swal2-input !m-0 !w-full" onchange="toggleProf(this.value)">
                        <option value="coletiva">Coletiva (Salão Inteiro)</option>
                        <option value="individual">Individual (Funcionário)</option>
                    </select>
                </div>
                <div id="div-prof" class="hidden">
                    <label class="block text-xs font-bold text-gray-400">PROFISSIONAL</label>
                    <select id="f-prof" class="swal2-input !m-0 !w-full">
                        {% for p in profissionais %}
                        <option value="{{ p.id }}">{{ p.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-xs font-bold text-gray-400">DATA/HORA INÍCIO</label>
                        <input type="datetime-local" id="f-inicio" class="swal2-input !m-0 !w-full">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-400">DATA/HORA FIM</label>
                        <input type="datetime-local" id="f-fim" class="swal2-input !m-0 !w-full">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400">MOTIVO</label>
                    <input id="f-motivo" class="swal2-input !m-0 !w-full" placeholder="Ex: Feriado, Médico, Férias">
                </div>
            </div>
        `,
        preConfirm: () => {
            return {
                profissional_id: document.getElementById('f-tipo').value === 'individual' ? document.getElementById('f-prof').value : null,
                inicio: document.getElementById('f-inicio').value,
                fim: document.getElementById('f-fim').value,
                motivo: document.getElementById('f-motivo').value
            }
        }
    }).then(result => {
        if(result.isConfirmed) {
            fetch("/equipe/api/add-folga/", {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}'},
                body: JSON.stringify(result.value)
            }).then(() => location.reload());
        }
    });
}

function toggleProf(val) {
    document.getElementById('div-prof').classList.toggle('hidden', val === 'coletiva');
}
</script>
{% endblock %}